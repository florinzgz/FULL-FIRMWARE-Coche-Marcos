[env:esp32-s3-devkitc]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.flash_size = 16MB
board_build.partitions = default.csv

monitor_speed = 115200
upload_speed = 921600
upload_port = COM3
monitor_port = COM3

lib_deps =
    bodmer/TFT_eSPI @ ^2.5.43
    dfrobot/DFRobotDFPlayerMini @ ^1.0.6
    milesburton/DallasTemperature@^4.0.5
    paulstoffregen/OneWire@^2.3.8
    https://github.com/adafruit/Adafruit-PWM-Servo-Driver-Library.git
    RobTillaart/INA226 @ ^0.6.4
    https://github.com/PaulStoffregen/XPT2046_Touchscreen.git
    fastled/FastLED @ 3.6.0
    adafruit/Adafruit MCP23017 Arduino Library @ ^2.3.2

build_flags =
    -DCORE_DEBUG_LEVEL=5
    -DUSER_SETUP_LOADED
    -std=gnu++17
    -DLOAD_GLCD
    -DLOAD_FONT2
    -DLOAD_FONT4
    -DLOAD_FONT6
    -DLOAD_FONT7
    -DLOAD_FONT8
    -DSMOOTH_FONT
    -Iinclude
    
    ; ========================================
    ; TFT_eSPI configuration for ST7796S (480x320)
    ; ESP32-S3-N16R8 con HSPI
    ; ========================================
    -DST7796_DRIVER
    -DTFT_WIDTH=480
    -DTFT_HEIGHT=320
    
    ; Pin mapping (must match pins.h)
    -DTFT_CS=8
    -DTFT_DC=13
    -DTFT_RST=14
    -DTFT_MOSI=11
    -DTFT_MISO=12
    -DTFT_SCLK=10
    -DTFT_BL=42
    
    ; ‚úÖ CORRECCI√ìN CR√çTICA: Touch pins (XPT2046)
    ; ANTES: -DTOUCH_CS=3  (conflictivo con strapping pins)
    ; DESPU√âS: GPIO 0 m√°s seguro para ESP32-S3
    -DTOUCH_CS=0
    
    ; Use HSPI bus on ESP32-S3
    -DUSE_HSPI_PORT
    
    ; SPI Frequencies optimizadas para ESP32-S3
    -DSPI_FREQUENCY=27000000       ; 27MHz para TFT (ST7796S soporta hasta 40MHz)
    -DSPI_READ_FREQUENCY=16000000  ; 16MHz para lecturas
    -DSPI_TOUCH_FREQUENCY=2500000  ; 2.5MHz para touch (m√°s estable)

    ; ‚úÖ A√ëADIDO: Configuraci√≥n I2C optimizada
    -DWIRE_HAS_TIMEOUT
    -DI2C_SDA=21
    -DI2C_SCL=22
    -DI2C_FREQUENCY=400000
    
    ; ‚úÖ A√ëADIDO: Configuraci√≥n PWM para ESP32-S3
    -DLEDC_TIMER_RESOLUTION=10  ; 10-bit resolution para PWM
    -DLEDC_BASE_FREQ=5000       ; 5kHz base frequency
    
    ; üîß Suprimir warnings de librer√≠as externas
    -w
    -Wno-unused-variable
    -Wno-unused-function
    -Wno-unknown-pragmas
    -Wno-macro-redefined
    -Wno-deprecated-declarations
    
    ; ‚úÖ MEJORADO: Configuraci√≥n de modo standalone con timeout
    ; Descomenta para modo test de pantalla standalone
    ; -DSTANDALONE_DISPLAY
    ; -DSTANDALONE_TIMEOUT=30000  ; 30 segundos timeout

; ===================================================================
; ‚úÖ NUEVO: Entorno de producci√≥n sin debug para mejor performance
; ===================================================================
[env:esp32-s3-devkitc-release]
extends = env:esp32-s3-devkitc
build_flags =
    ${env:esp32-s3-devkitc.build_flags}
    -DCORE_DEBUG_LEVEL=0        ; Sin debug en producci√≥n
    -Os                         ; Optimizaci√≥n de tama√±o
    -DNDEBUG                    ; Desactivar asserts
    ; Comentado el modo standalone para producci√≥n
    ; -DSTANDALONE_DISPLAY

; ===================================================================
; ‚úÖ NUEVO: Entorno para OTA (Over-The-Air updates)
; ===================================================================
[env:esp32-s3-devkitc-ota]
extends = env:esp32-s3-devkitc
upload_protocol = espota
upload_port = 192.168.1.100     ; IP del ESP32 en tu red WiFi
upload_flags = 
    --port=3232
    --auth=your_ota_password     ; Cambiar por tu password OTA
build_flags =
    ${env:esp32-s3-devkitc.build_flags}
    -DENABLE_OTA
    -DOTA_PASSWORD=\"your_ota_password\"
    -DWIFI_SSID=\"your_wifi_ssid\"
    -DWIFI_PASSWORD=\"your_wifi_password\"

; ===================================================================
; ‚úÖ NUEVO: Configuraciones espec√≠ficas para testing
; ===================================================================
[env:esp32-s3-devkitc-test]
extends = env:esp32-s3-devkitc
build_flags =
    ${env:esp32-s3-devkitc.build_flags}
    -DCORE_DEBUG_LEVEL=5        ; M√°ximo debug para testing
    -DTEST_MODE                 ; Activar modo test
    -DSTANDALONE_DISPLAY        ; Modo standalone para test pantalla
    -DTEST_ALL_LEDS            ; Test de todas las LEDs
    -DTEST_ALL_SENSORS         ; Test de todos los sensores