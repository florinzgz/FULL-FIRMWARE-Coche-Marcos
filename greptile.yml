name: "Firmware Coche Marcos ESP32-S3"
description: "Firmware completo para veh√≠culo inteligente con ESP32-S3-DevKitC-1"
version: "1.0.0"
type: "embedded_firmware"

include:
  - "src/**/*.cpp"
  - "src/**/*.c"
  - "include/**/*.h"
  - "include/**/*.hpp"
  - "platformio.ini"
  - "project_config.ini"
  - "docs/**/*.md"
  - "*.md"
  - "ADVANCED_SAFETY_SYSTEMS.md"
  - "WIFI_OTA_SETUP.md"
  - ".github/**/*.yml"
  - ".github/**/*.yaml"
  - ".github/workflows/build.yml"
  - "*.sh"
  - "scripts/**/*.sh"
  - "create_script_*.sh"
  - "apply_corrections.sh"

exclude:
  - ".pio/**/*"
  - ".pio/*"
  - "build/**/*"
  - "lib/**/*"
  - ".vscode/**/*"
  - ".vscode/*.db*"
  - ".vscode/c_cpp_properties.json"
  - ".vscode/launch.json"
  - ".vscode/ipch"
  - "*.db"
  - "*.db-*"
  - "*.tmp"
  - "*.temp"
  - "*.log"
  - "compile.log"
  - "*.bin"
  - "*.elf"
  - "*.hex"
  - "*.map"
  - "firmware.*"
  - "backups_*/**/*"
  - "*.backup"
  - "*.bak"
  - "audio/*"
  - "data/*"
  - ".git/**/*"
  - ".gitignore"
languages:
  cpp:
    extensions: [".cpp", ".c", ".h", ".hpp"]
    include_patterns: ["*.ino"]
    parsing:
      framework_detection: true
      preprocessor_aware: true
      custom_patterns:
        - "namespace\\s+(\\w+)\\s*\\{"
        - "#define\\s+PIN_(\\w+)\\s+(\\d+)"
        - "void\\s+(\\w+)::init\\(\\)"
  ini:
    extensions: [".ini"]
    include_patterns: ["platformio.ini", "project_config.ini"]
  yaml:
    extensions: [".yml", ".yaml"]
    include_patterns: [".github/workflows/*.yml"]
  markdown:
    extensions: [".md"]
    include_patterns: ["README*", "CHANGELOG*", "docs/**/*.md", "ADVANCED_SAFETY_SYSTEMS.md", "WIFI_OTA_SETUP.md"]
  shell:
    extensions: [".sh"]
    include_patterns: ["*.sh", "create_script_*.sh", "apply_corrections.sh"]

indexing:
  mode: "deep"
  patterns:
    - pattern: "namespace\\s+(Buttons|Steering|ABSSystem|LEDController|HUDManager|Traction|Watchdog|Relays|Audio|System)\\s*\\{"
      type: "firmware_namespace"
      scope: "module"
      priority: "high"
    - pattern: "#define\\s+PIN_(\\w+)\\s+(\\d+)"
      type: "gpio_pin"
      scope: "hardware"
      priority: "critical"
    - pattern: "#define\\s+I2C_ADDR_(\\w+)\\s+(0x[0-9A-Fa-f]+)"
      type: "i2c_address"
      scope: "hardware"
      priority: "high"
    - pattern: "#define\\s+I2C_ADDR_PCA9685_(FRONT|REAR|STEERING)\\s+(0x[0-9A-Fa-f]+)"
      type: "pca9685_address"
      scope: "motor_control"
      priority: "high"
    - pattern: "#define\\s+I2C_ADDR_MCP23017_(\\w+)\\s+(0x[0-9A-Fa-f]+)"
      type: "mcp23017_address"
      scope: "gpio_expander"
      priority: "high"
    - pattern: "void\\s+(\\w+)::init\\(\\)"
      type: "init_function"
      scope: "initialization"
      priority: "medium"
    - pattern: "struct\\s+(\\w*State)\\s*\\{"
      type: "state_struct"
      scope: "data_structure"
      priority: "medium"
    - pattern: "\\[(env:\\w+)\\]"
      type: "platformio_env"
      scope: "build_config"
      priority: "medium"
search:
  priority_files:
    - "include/pins.h"
    - "include/system.h"
    - "platformio.ini"
    - "src/main.cpp"
    - "project_config.ini"
    - "include/relays.h"
    - "src/control/relays.cpp"
    - "ADVANCED_SAFETY_SYSTEMS.md"
    - "docs/FIRMWARE_FINAL_STATUS.md"
    - ".github/workflows/build.yml"
  keywords:
    hardware:
      - "ESP32-S3"
      - "DevKitC"
      - "GPIO"
      - "I2C"
      - "SPI"
      - "UART"
      - "PWM"
      - "ADC"
      - "esp32-s3-devkitc-1"
    components:
      - "PCA9685"
      - "MCP23017"
      - "TCA9548A"
      - "INA226"
      - "ST7796"
      - "XPT2046"
      - "BTS7960"
      - "WS2812B"
      - "DS18B20"
      - "HY-M158"
      - "DFPlayer"
    firmware_modules:
      - "Buttons"
      - "Steering"
      - "ABSSystem"
      - "TCSSystem"
      - "LEDController"
      - "HUDManager"
      - "Traction"
      - "Watchdog"
      - "Relays"
      - "Audio"
      - "WiFiManager"
      - "RegenAI"
    safety_systems:
      - "ABS"
      - "TCS"
      - "RegenAI"
      - "slipThreshold"
      - "pressureReduction"
      - "aggressiveness"
      - "TelemetryPacket"
    algorithms:
      - "Calibration"
      - "Filter"
      - "PID"
      - "NonBlocking"
      - "StateMachine"

analysis:
  metrics:
    - "memory_usage"
    - "cycle_complexity"
    - "dependency_depth"
    - "interrupt_safety"
    - "namespace_cohesion"
  anti_patterns:
    - "blocking_delay"
    - "global_variables"
    - "hardcoded_values"
    - "memory_leaks"
    - "infinite_loops"
  quality_gates:
    - name: "compilation"
      threshold: 100
      description: "All files must compile successfully"
    - name: "memory_safety"
      threshold: 95
      description: "Memory safety score must be above 95%"
    - name: "real_time_safety"
      threshold: 90
      description: "Real-time safety score for embedded constraints"
semantic:
  groups:
    input_handling:
      - "src/input/**/*"
      - "include/buttons.h"
      - "include/pedal.h"
      - "include/steering.h"
      - "include/shifter.h"
    motor_control:
      - "src/control/**/*"
      - "include/traction.h"
      - "include/relays.h"
      - "include/steering_motor.h"
    safety_systems:
      - "src/safety/**/*"
      - "include/abs_system.h"
      - "include/tcs_system.h"
      - "include/regen_ai.h"
    user_interface:
      - "src/hud/**/*"
      - "include/hud.h"
      - "include/gauges.h"
      - "include/icons.h"
      - "include/wheels_display.h"
    communication:
      - "src/core/wifi_manager.cpp"
      - "src/core/bluetooth_controller.cpp"
      - "include/wifi_manager.h"
      - "include/bluetooth_controller.h"
    audio_system:
      - "src/audio/**/*"
      - "include/dfplayer.h"
      - "include/alerts.h"
      - "include/queue.h"
    sensors:
      - "src/sensors/**/*"
      - "include/car_sensors.h"
      - "include/current.h"
      - "include/temperature.h"
      - "include/wheels.h"
    lighting:
      - "src/lighting/**/*"
      - "include/led_controller.h"
    build_config:
      - "platformio.ini"
      - "project_config.ini"
      - ".github/workflows/build.yml"
    documentation:
      - "docs/**/*"
      - "ADVANCED_SAFETY_SYSTEMS.md"
      - "WIFI_OTA_SETUP.md"
      - "*.md"

context:
  project_type: "embedded_firmware"
  target_platform: "ESP32-S3"
  programming_language: "C++"
  build_system: "PlatformIO"
  framework: "Arduino"
  main_features:
    - "Vehicle control system"
    - "Safety systems (ABS, TCS, RegenAI)"
    - "Real-time embedded processing"
    - "Multi-sensor integration"
    - "User interface (HUD, touch display)"
    - "Wireless connectivity (WiFi, Bluetooth)"
    - "Audio alerts and feedback"
    - "LED lighting control"
  hardware_integration:
    - "ESP32-S3-DevKitC-1 main board"
    - "ST7796 display with XPT2046 touch"
    - "Multiple I2C devices (PCA9685, MCP23017, INA226, TCA9548A)"
    - "Motor control (BTS7960)"
    - "Audio module (HY-M158/DFPlayer)"
    - "Temperature sensors (DS18B20)"
    - "LED strips (WS2812B)"

repository_structure:
  source_organization: "modular_by_feature"
  namespace_pattern: "functional_grouping"
  build_automation: "github_actions_ci"
  documentation_strategy: "comprehensive_markdown"