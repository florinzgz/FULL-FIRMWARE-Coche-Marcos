# .coderabbit.yaml
# Configuración de CodeRabbit para firmware ESP32-S3

language: "es"  # Comentarios en español

reviews:
  # Activar reviews automáticos
  auto_review:
    enabled: true
    drafts: false  # No revisar PRs en draft
  
  # Mostrar estado de review
  review_status: true
  
  # Nivel de detalle en reviews
  profile: "assertive"  # chill | cautious | assertive
  
  # Configuración de verificaciones
  request_changes_workflow: false
  high_level_summary: true
  high_level_summary_placeholder: "**Resumen de cambios**"
  poem: false  # Sin poemas al final
  review_status_comment: true
  
  # Collapse walks para PRs grandes
  collapse_walkthrough: false
  
  # Auto-incrementar al hacer cambios
  auto_incremental_review: true
  
  # Verificaciones de código
  tools:
    ruff:
      enabled: false  # Python linter - no necesario
    shellcheck:
      enabled: true   # Para scripts .sh
    
# Filtros de archivos - ignorar binarios y builds
path_filters:
  - "!**/*.bin"
  - "!**/*.hex"
  - "!**/*.elf"
  - "!**/*.o"
  - "!**/*.a"
  - "!.pio/**"
  - "!.vscode/**"
  - "!.platformio/**"
  - "!**/.pio/**"
  - "!**/build/**"
  - "!audio/**/*.mp3"
  - "!audio/**/*.wav"
  
# Instrucciones personalizadas para el bot
instructions:
  - "Este es firmware embebido para ESP32-S3 usando PlatformIO y Arduino framework"
  - "Prioridad en seguridad, manejo de errores y uso eficiente de memoria"
  - "Revisar correcta inicialización de periféricos (I2C, SPI, PWM)"
  - "Verificar uso apropiado del Watchdog timer"
  - "Detectar posibles memory leaks, stack overflows o buffer overruns"
  - "Validar manejo de fallos en sensores y sistemas críticos"
  - "Revisar sincronización entre tasks y uso de delays"
  - "Verificar que los managers inicialicen correctamente sus subsistemas"
  - "Comprobar que los punteros y referencias sean válidos antes de usar"
  - "Validar rangos de arrays y tamaños de buffers"
  
# Configuración de chat
chat:
  auto_reply: false  # No responder automáticamente

# Conocimiento del dominio
knowledge_base:
  learnings:
    - path: "src/core"
      content: |
        ESP32-S3 firmware con arquitectura de managers para vehículo eléctrico.
        
        Arquitectura de managers:
        - PowerManager: Gestión de relays y secuencia de encendido seguro
        - SafetyManager: Coordina ABS, TCS y detección de obstáculos
        - SensorManager: Inicializa y actualiza sensores (INA226, DS18B20, encoders)
        - ControlManager: Gestiona tracción, dirección y actuadores
        - HUDManager: Interfaz de usuario en pantalla TFT 480x320
        
        Sistemas de seguridad:
        - Tolerancia a fallos en sensores críticos
        - Watchdog timer para prevenir bloqueos
        - Sistema de logging de errores
        - Gestión de errores no bloqueante
        
    - path: "**/*.cpp"
      content: |
        Tecnologías y componentes clave:
        - ABS (Anti-lock Braking System): Sistema antibloqueo de frenos
        - TCS (Traction Control System): Control de tracción 4x4
        - HUD (Head-Up Display): Pantalla TFT ST7796S 480x320
        - INA226: Sensor de corriente/voltaje I2C de alta precisión
        - DS18B20: Sensor de temperatura 1-Wire (5 unidades: 4 motores + ambiente)
        - WS2812B: LEDs RGB direccionables (FastLED)
        - TFT_eSPI: Librería optimizada para pantallas TFT en ESP32
        - XPT2046: Controlador táctil resistivo
        
        Periféricos y comunicación:
        - I2C: INA226 (sensores de corriente), MCP23017 (expansores GPIO)
        - SPI: Pantalla TFT, touch XPT2046
        - 1-Wire: DS18B20 (sensores temperatura)
        - PWM: Control de motores, LEDs, steering servo
        - UART: DFPlayer (audio), telemetría
